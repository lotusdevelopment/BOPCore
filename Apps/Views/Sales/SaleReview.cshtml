@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisión de mi venta</title>
    <link href="~/Content/materialize.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" href="~/Content/Images/faviconLotus.ico" type="image/x-icon" />
    @Scripts.Render("~/bundles/jquery")
    <style>
        html, body {
            margin: 0;
            border: 0;
            padding: 0;
            overflow-x: hidden;
        }

        header img.logo {
            display: block;
            width: 100%;
            margin: 0 auto;
            min-width: 150px;
            max-width: 300px;
        }

        footer {
            text-align: right;
            margin-bottom: 1pc;
        }

            footer label {
                padding: 1pc;
            }

        .btn, .btn-large {
            background-color: #41C0E0 !important;
        }

        #tab1, #tab2 {
            display: none;
        }

        @@media (max-width: 600px) {
            .row .col.offset-s5 {
                margin-left: 0 !important;
            }

            .row .col.s2 {
                width: 100% !important;
            }

            .upper-border {
                margin-bottom: 1pc;
            }

            .bordered-item {
                height: auto;
            }

                .bordered-item span {
                    height: 100%;
                    width: 100%;
                    text-align: center;
                    margin: 0 auto;
                }

                .bordered-item img {
                    display: none;
                }
            /*font sizes*/

            h1 {
                font-size: 9vw;
            }

            h2 {
                font-size: 7.5vw;
            }

            h3 {
                font-size: 6.8vw;
            }

            h4 {
                font-size: 5vw;
            }

            h5 {
                font-size: 4.2vw;
            }

            p {
                font-size: 2vmin;
            }

            #sale-body input, #sale-body .material-icons, #sale-body select,
            #sale-body textarea, #sale-body div, #sale-body label, #sale-body span {
                font-size: 5vw;
            }
        }

        @@media (max-width: 900px) {
            .row .col.s6 {
                width: 100% !important;
            }

            .e-button {
                margin: 0 auto;
                display: block;
            }

            .row .col.s3 {
                width: 100% !important;
                display: block !important;
                text-align: center !important;
            }

                .row .col.s3 label {
                    text-align: center !important;
                }

            .row .col.s9 {
                width: 100% !important;
                display: block !important;
            }

            .inner-plan-tab .col.s4 label {
                display: block !important;
            }

            .row .col.offset-m3, .row .col.offset-s3 {
                margin-left: 0 !important;
            }

            nav .nav-wrapper {
                background: #FF3D81 !important;
            }

            .logo-title {
                color: white !important;
            }
        }
    </style>
</head>

<body>
    <div class="mdl-layout mdl-js-layout">
        <header class="mdl-layout__header">
            <img src="~/Content/Images/lotuslogo.png" alt="Lotus" class="logo" />
        </header>
        <main class="mdl-layout__content" style="flex: 1 0 auto;">
            <div class="container">
                <div id="tab1">
                    <h3>Bienvenido</h3>
                    <span>Aquí podrás verificar y solicitar la factura de venta de tus planes Lotus.</span>
                    <div class="row">
                        <div class="col s6 offset-s3">
                            <div class="row">
                                <div class="input-field col s12">
                                    <i class="material-icons prefix">phonelink_ring</i>
                                    <input type="tel" id="Phone" class="validate" />
                                    <label for="Phone">Número de celular</label>
                                </div>
                                <div class="input-field col s12">
                                    <i class="material-icons prefix">confirmation_number</i>
                                    <input type="tel" id="SaleId" class="validate" />
                                    <label for="SaleId">Código de venta</label>
                                </div>
                                <div class="row">
                                    <div class="input-field col s12 m12 offset-m4">
                                        <input type="submit" id="sbtmBtn" value="Verificar venta" class="btn btn-default" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="tab2">
                    <h3>Actualiza tus datos para poder enviarte la factura a tu correo electrónico</h3>
                    <div class="col s6 offset-s3">
                        <div class="row">
                            <div class="input-field col s6">
                                <i class="material-icons prefix">account_circle</i>
                                <input type="text" id="Name" class="validateA" />
                                <label for="Name">Nombre</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">account_circle</i>
                                <input type="text" id="LastName" class="validateA" />
                                <label for="SaleId">LastName</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">email</i>
                                <input type="email" id="Email" class="validateA" />
                                <label for="Email">Email</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">date_range</i>
                                <input type="date" id="Birthday" class="datepicker validateA" />
                                <label for="Birthday">Fecha de nacimiento</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">add_location</i>
                                <input type="text" id="Address" class="validateA" />
                                <label for="Address">Dirección</label>
                            </div>
                            <div class="row">
                                <div class="input-field col s12 m12 offset-m4">
                                    <input type="submit" id="sbtmBtn2" value="Solicitar Factura" class="btn btn-default" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="mdl-mega-footer">
            <hr />
            <label>&copy; Lotus Odonto S.A.S Todos los derechos reservados @DateTime.Now.Year </label>
        </footer>
    </div>
    @Scripts.Render("~/bundles/bootstrap")
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">
        (function () {
            var sale;
            var isNullOrEmpty = function (name, type) {
                var val = false;
                switch (type) {
                    case "class":
                        $("." + name).each(function (i, j) {
                            if (j.value === "" || j.value == null || j.value == " ") {
                                val = true;
                                $('#' + j.id).addClass("invalid");
                            } else
                                $('#' + j.id).addClass("valid");
                        });
                        break;
                }
                return val;
            }
            var isValidEmailAddress = function (emailAddress) {
                var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
                return pattern.test(emailAddress);
            };
            var validatePhone = function (txtPhone) {
                var filter = /^((\+[1-9]{1,4}[ \-]*)|(\([0-9]{2,3}\)[ \-]*)|([0-9]{2,4})[ \-]*)*?[0-9]{3,4}?[ \-]*[0-9]{3,4}?$/;
                if (filter.test(txtPhone))
                    return true;
                return false;
            }
            var guid = function () {
                function s4() {
                    return Math.floor((1 + Math.random()) * 0x10000)
                        .toString(16)
                        .substring(1);
                }
                return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                    s4() + '-' + s4() + s4() + s4();
            }
            var sendToTop = function () {
                $("html, body").animate({ scrollTop: 0 }, "fast");
            }
            var validateData = function () {
                $.ajax({
                    url: "/Others/ValidateSale",
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify({ phone: $("#Phone").val(), id: $("#SaleId").val(), format: guid() }),
                    error: function (xhr) {
                        debugger;
                        alert("Error validando la venta");
                        location.reload();
                        return false;
                    },
                    success: function (result) {
                        sendToTop();
                        if (result.Error.IsError) {
                            alert(result.Error.Message);
                            $("#Phone").val("");
                            $("#SaleId").val("");
                            return;
                        }
                        sale = result.Sale;
                        $('#tab1').hide("slide", { direction: "left" }, 300);
                        $('#tab2').show("slide", { direction: "right" }, 300);
                        return;
                    },
                    async: true
                });
            }
            var updateAndSendData = function () {
                if (sale.Name.toUpperCase() !== $("#Name").val().toUpperCase())
                    sale.Name = $("#Name").val();
                if (sale.Name.toUpperCase() !== $("#LastName").val().toUpperCase())
                    sale.LastName = $("#LastName").val();
                if (sale.Name.toUpperCase() !== $("#Email").val().toUpperCase())
                    sale.Email = $("#Email").val();
                if (sale.Name.toUpperCase() !== $("#Birthday").val().toUpperCase())
                    sale.Birthday = $("#Birthday").val();
                if (sale.Name.toUpperCase() !== $("#Address").val().toUpperCase())
                    sale.Address = $("#Address").val();
                $.ajax({
                    url: "/Others/UpdateAndSendData",
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify({ model: sale }),
                    error: function (xhr) {
                        alert("Proceso realizado satisfactoriamente.");
                        window.location.href = "http://www.lotusodonto.com/";
                    },
                    success: function (result) {
                        alert("Proceso realizado satisfactoriamente.");
                        window.location.href = "http://www.lotusodonto.com/";
                    },
                    async: true
                });
            }
            $(document).ready(function () {
                var d = new Date();
                $('.datepicker').pickadate({
                    selectMonths: true,
                    selectYears: 100,
                    closeOnSelect: true,
                    closeOnClear: true,
                    format: 'yyyy-mm-dd',
                    max: d
                });
                $("#tab1").show();
                $("#sbtmBtn").click(function () {
                    if (isNullOrEmpty("validate", "class"))
                        return;
                    if (!validatePhone($("#Phone").val())) {
                        $("#Phone").addClass("invalid");
                        alert("Ingrese un número de celular válido");
                        return;
                    }
                    validateData();
                });
                $("#sbtmBtn2").click(function () {
                    if (isNullOrEmpty("validateA", "class"))
                        return;
                    if (!isValidEmailAddress($("#Email").val())) {
                        $("#Email").addClass("invalid");
                        alert("Ingrese un Email válido");
                        return;
                    }
                    updateAndSendData();
                });
            });
        })();
    </script>
</body>
</html>
